# 敏捷迭代计划（MVP｜5周）

## 总体设定
- 节奏：1周/迭代（S0–S4），每日站会15分钟；评审/回顾各30分钟
- 角色：架构师/PO/RD/FE/QA
- DoD（通用）：
  - 需求含验收标准；代码 Docstring+中文注释；ruff/mypy/pytest/coverage≥80%
  - OpenAPI 合同同步；关键路径 E2E/a11y 通过；文档/监控面板更新

## S0（第1周）基础设施与合同
- 目标：最小可运行架构与合同、冻结 MVP 范围
- 交付：
  - 架构文档：`docs/ai-llm-architecture.md`
  - OpenAPI 合同草案（/api/v1/ai/chat）
  - 数据集：`content/kids_3yo_dataset.json`
  - 执行清单：`sop/CHECKLIST-EXEC.md`
- 验收：schemathesis 合同测试通过；术语一致

## S1（第2周）AI核心通路（非流式）
- 目标：OpenAI兼容非流式对话，支持自定义 base_url/api_key
- 交付：
  - 后端：OpenAICompatibleClient（超时/重试）、/api/v1/ai/chat 非流式响应
  - 容错：最小重试×3、基础熔断、Failover 路由（不回切）
  - FE：非流式调用与取消、统一错误提示
  - QA：合同测试、网络异常注入
- 指标：成功率≥99%、P95<3s

## S2（第3周）流式与微课初版
- 目标：稳定流式（SSE）与首批学习流
- 交付：
  - 后端：/api/v1/ai/chat `stream=true`、SSE分块兼容
  - FE：ReadableStream 合并、断线指数退避、进度UI
  - 内容：三段故事（第2段动作口令）+ TTS、低龄模板与自动重写
  - QA：流/非流一致性、收尾块/finish_reason 校验
- 指标：TTS首播<1.5s；中断恢复<3s

## S3（第4周）个性化与家长教练、观测
- 目标：AI赋能“日常微课”与家长教练提示、可观测完善
- 交付：
  - 个性化推荐（规则+近因记忆）：兴趣/正确率/停留驱动“2卡+1故事+1亲情+1逻辑”
  - 家长教练：完成后1-2句正向引导（感谢/拥抱/小帮手/复述法）
  - 观测：结构化日志、OTelTrace；Prom指标（成功/超时/熔断/切换/时延）
  - FE：家长面板（时长/正确率/互动/新尝试），TTS/主题/夜间开关
  - QA：阈值告警演练、埋点回放
- 指标：微课完成率≥70%；家长提示采用率≥60%

## S4（第5周）硬化与发布（灰度）
- 目标：容错灾备完善、适配与体验打磨、GA
- 交付：
  - Failover 完整：多提供方优先级、自动回切；熔断参数调优
  - 安全合规：文本敏感/危险动作自动重写；图片安全提示词
  - 适配/a11y：375/768/1280 核心路径；对比度AA、键盘可达
  - E2E：跨断点与a11y；小压测
  - 发布：手动灰度；回滚标准演练
- 指标：可用性>99.9%；错误率<0.5%；P95 API<200ms；Web Vitals 达标

## 角色分工
- RD：客户端/路由/熔断Failover/合同/监控/TTS
- FE：非流→流式整合、UI与a11y、家长面板与埋点
- QA：合同/网络异常/一致性/E2E/a11y、性能与回归
- 架构师：方案把关、非功能指标、风险控制与发布评审
- PO：验收、微课策略与内容把关

## 风险与缓解
- 网络不稳定：多provider+熔断+Failover+回切；边缘代理
- 成本/时延：主题级缓存、主备路由、限流与提示
- 内容安全：自动重写+词表；抽检
- 兼容性：低端机压测、降级策略

## 追踪与里程碑
- 看板：Ready/Doing/PR/QA/Done；每迭代目标可度量
- 关键指标：成功率/P95/中断恢复/微课完成率/家长提示/a11y问题
- 里程碑：S2 内测、S3 Beta、S4 GA